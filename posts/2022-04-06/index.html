<!doctype html><html lang=ja-jp>
<head>
<link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous>
<link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> メールのドメイン認証まとめ | Xrzheaven</title>
<link rel=canonical href=https://xrzhev.com/posts/2022-04-06/>
<meta name=description content="いろいろやっていき">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="メールのドメイン認証まとめ">
<meta property="og:description" content="すでに枯れた技術なのにミドルウェアの設定がめんどくさいメールサーバー。 メールサーバーを作るとき、色々見ながら設定はするけどよくわからんドメイ">
<meta property="og:type" content="article">
<meta property="og:url" content="https://xrzhev.com/posts/2022-04-06/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-04-06T20:12:19+09:00">
<meta property="article:modified_time" content="2022-04-07T14:07:54+09:00">
<meta property="og:image" content="https://xrzhev.com/posts/2022-04-06/img/ogp/index.webp">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="メールのドメイン認証まとめ">
<meta name=twitter:description content="すでに枯れた技術なのにミドルウェアの設定がめんどくさいメールサーバー。 メールサーバーを作るとき、色々見ながら設定はするけどよくわからんドメイ">
<meta name=twitter:image content="https://xrzhev.com/posts/2022-04-06/img/ogp/index.webp">
<link rel=stylesheet href=https://xrzhev.com/css/styles.bffb01f49c32dfc08ab4bab122ea7a283cac2fb1be2e0ed85c8927eeff6b4431c3302f1bf04324ac1a7a255fabef5a2dcd172d756ee959224dc671c4db1f7af1.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://xrzhev.com/images/favicon.ico>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M0JBLYFQ0B"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-M0JBLYFQ0B',{anonymize_ip:!1})}</script>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Posts</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/index.xml>Rss</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://xrzhev.com/posts/2022-04-04/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=https://xrzhev.com/posts/2022-04-20/ aria-label=Next>
<i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&text=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&title=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81&body=Check out this article: https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&title=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&title=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&t=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#ドメイン認証とは>ドメイン認証とは</a></li>
<li><a href=#具体的なドメイン認証のやり方>具体的なドメイン認証のやり方</a></li>
<li><a href=#ptrレコードの設定-難易度-very-easy>PTRレコードの設定 (難易度: Very Easy)</a></li>
<li><a href=#spfレコードの設定-難易度-easy>SPFレコードの設定 (難易度: Easy)</a>
<ul>
<li><a href=#注意事項>[注意事項]</a></li>
</ul>
</li>
<li><a href=#dkimレコードの設定-難易度-medium>DKIMレコードの設定 (難易度: Medium)</a></li>
<li><a href=#dmarcレコードの設定-難易度-easy>DMARCレコードの設定 (難易度: Easy)</a></li>
<li><a href=#インフラエンジニアとしての個人のお気持ち>インフラエンジニアとしての個人のお気持ち</a></li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
メールのドメイン認証まとめ
</h1>
<div class=meta>
<div class=postdate>
投稿日: <time datetime="2022-04-06 20:12:19 +0900 +0900" itemprop=datePublished>2022-04-06 20:12</time>
</div>
<div class=lastmoddate>
最終更新日: <time datetime="2022-04-07 14:07:54 +0900 +0900" itemprop=dateModified>2022-04-07 14:07</time>
</div>
<div class=article-category>
<i class="fas fa-archive"></i>
<a class=category-link href=/categories/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%8A%80%E8%A1%93>インフラ技術</a>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/%E3%83%A1%E3%83%BC%E3%83%AB rel=tag>メール</a>
,
<a class=tag-link href=/tags/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9 rel=tag>インフラ</a>
,
<a class=tag-link href=/tags/%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC rel=tag>サーバー</a>
,
<a class=tag-link href=/tags/%E5%88%9D%E5%BF%83%E8%80%85%E5%90%91%E3%81%91 rel=tag>初心者向け</a>
,
<a class=tag-link href=/tags/%E3%81%8A%E6%B0%97%E6%8C%81%E3%81%A1 rel=tag>お気持ち</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<p>すでに枯れた技術なのにミドルウェアの設定がめんどくさいメールサーバー。<br>
メールサーバーを作るとき、色々見ながら設定はするけどよくわからんドメイン認証。<br>
新年度ということもあり、初心者でもメールサーバーを構築するにあたって使うであろうドメイン認証の一覧を簡単な説明を載せて書いておく。<br>
各技術はそれ相応に深いもので、本ページだけでの理解は難しいため、適宜色々な解説サイトやRFCを読み込んで仕様を理解してほしい。</p>
<h2 id=ドメイン認証とは>ドメイン認証とは</h2>
<p>メールの送付元ドメインが <strong>&ldquo;本物&rdquo;</strong> であることをチェックする為に使われている技術。<br>
これはメールの仕様上、メールの送信元をユーザー側から見たときにある程度詐称できることからきている。<br>
送信元メールサーバーから送付先メールサーバーに届けられるメールの中には宛先・送信者にまつわる2つの重要なデータが存在している。<br>
それが <strong>エンベロープ</strong> と <strong>ヘッダー</strong> 。<br>
上記の言葉については様々なサイトで解説しているので割愛するが、基本的にヘッダーを書き換えることでなりすましができる。<br>
以下のプログラムは、なりすましメールを作ることができるもの。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#75715e>#!/usr/bin/env python3</span>

<span style=color:#75715e>###########</span>
<span style=color:#75715e>### 免責事項 </span>
<span style=color:#75715e>###########</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># 本プログラムは検証・勉強用途のみに利用すること。</span>
<span style=color:#75715e># 本プログラムを利用して発生したいかなる事象に対し著者は一切の責任を持たない。  </span>
<span style=color:#75715e>#</span>

<span style=color:#f92672>from</span> smtplib <span style=color:#f92672>import</span> SMTP
<span style=color:#f92672>from</span> email.mime.text <span style=color:#f92672>import</span> MIMEText

<span style=color:#75715e># Envelope</span>
ENVELOPE_TO   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;realreceiver@to.example.com&#34;</span>
ENVELOPE_FROM <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;realsender@from.example.com&#34;</span>

<span style=color:#75715e># Header (Fake)</span>
HEADER_TO   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fakereceiver@fake.to.example.com&#34;</span>
HEADER_FROM <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fakesender@fake.from.example.com&#34;</span>

<span style=color:#75715e># SMTP Server</span>
SMTP_HOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;smtp.example.com&#34;</span>
SMTP_USER <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;exampleuser&#34;</span>
SMTP_PASS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;examplepass&#34;</span>

<span style=color:#75715e># Header and Body</span>
body <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hogehoge&#34;</span>
msg <span style=color:#f92672>=</span> MIMEText(body, <span style=color:#e6db74>&#34;html&#34;</span>)
msg[<span style=color:#e6db74>&#34;Subject&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Fake Email&#34;</span>
<span style=color:#75715e># 以下のTo, Fromを書き換えればなりすましが可能（メールヘッダー）</span>
msg[<span style=color:#e6db74>&#34;To&#34;</span>] <span style=color:#f92672>=</span> HEADER_TO
msg[<span style=color:#e6db74>&#34;From&#34;</span>] <span style=color:#f92672>=</span> HEADER_FROM

MESSAGE <span style=color:#f92672>=</span> msg<span style=color:#f92672>.</span>as_string()

mail_serv <span style=color:#f92672>=</span> SMTP(SMTP_HOST)
mail_serv<span style=color:#f92672>.</span>set_debuglevel(<span style=color:#66d9ef>True</span>)
mail_serv<span style=color:#f92672>.</span>ehlo()
mail_serv<span style=color:#f92672>.</span>starttls()
mail_serv<span style=color:#f92672>.</span>ehlo()
mail_serv<span style=color:#f92672>.</span>login(SMTP_USER, SMTP_PASS)
mail_serv<span style=color:#f92672>.</span>sendmail(ENVELOPE_FROM, ENVELOPE_TO, MESSAGE)
mail_serv<span style=color:#f92672>.</span>quit()
</code></pre></div><p>上記のような例の場合、</p>
<ul>
<li>
<p>エンベロープ</p>
<ul>
<li>To(受信側): <a href=mailto:realreceiver@to.example.com>realreceiver@to.example.com</a>
<ul>
<li>改ざん<strong>不可能</strong>: メールはこの宛先のメールサーバーへと飛ぶため、改ざん不可能。</li>
</ul>
</li>
<li>From(送信側): <a href=mailto:realsender@from.example.com>realsender@from.example.com</a>
<ul>
<li>改ざん<strong>可能</strong>: メールが送付できなかった場合、リターンメールがこのメールアドレス宛に飛ぶ。それを無視してもよいなら改ざんできる。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ヘッダー</p>
<ul>
<li>To(受信側): <a href=mailto:fakereceiver@fake.to.example.com>fakereceiver@fake.to.example.com</a>
<ul>
<li>改ざん<strong>可能</strong>: ほとんどのメールクライアントはここに書かれているものを受信者として表示する。</li>
</ul>
</li>
<li>From(送信側): <a href=mailto:fakesender@fake.from.example.com>fakesender@fake.from.example.com</a>
<ul>
<li>改ざん<strong>可能</strong>: ほとんどのメールクライアントはここに書かれているもの送信者として表示する。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>という形になる。<br>
上記のプログラムでメールを送付した場合、fakesender, fakereceiverというFromヘッダーが改ざんされたメールが送付される。</p>
<p>1件、個人で持っているメールアドレス宛に、ある種いい例といえるなりすまし迷惑メールが来ていたので紹介する。<br>
<img src=./img/001.webp alt=ゴミカスscam野郎></p>
<p>赤く塗りつぶしている部分はすべて私が利用している同一のメールユーザーを示すもの。<br>
上記のスクリーンショットは以下の点がおかしいといえる。</p>
<ul>
<li>Fromが自分のメールアドレスになっており、謎の経由地が存在する。</li>
<li>送信元が明らかに三菱UFJではない。</li>
</ul>
<p>これはいわゆるメールによるフィッシング詐欺というもの。邪悪。<br>
これはヘッダーFromを私のメールアドレスに書き換えて送付してきている。</p>
<p>なりすましメール自体は今に始まったものではなく、かなり歴史が古い。<br>
しかしながら今回言及していくドメイン認証技術の一般的な普及により、なりすましメールを送付すること自体がそもそも難しくなってきているのが現状。</p>
<h2 id=具体的なドメイン認証のやり方>具体的なドメイン認証のやり方</h2>
<p>複数個あるので以下に一覧として簡単にまとめていく。<br>
以下に書く手法は1つだけやっておけばOK！というものではなく、基本全部設定することを推奨する。<br>
全部やればなりすまし判定が極めてされ<strong>にくい</strong>。<br>
（ここで「なりすまし判定がされない」と断言したいところだが、メールサーバーにはレピュテーションという隠れスコアがあって闇が深い。）<br>
実際のところ、送信側での設定でSPFだけ入れときゃ問題なく送れるサーバーもあるし、DKIM, DMARKまできっちり設定しても受信側で迷惑メール判定が長い間続くサーバーも存在する。</p>
<h2 id=ptrレコードの設定-難易度-very-easy>PTRレコードの設定 (難易度: Very Easy)</h2>
<p>だいぶ昔からある設定方式のはず。初出はいつなのかわからない。<br>
送信側メールサーバーに設定されるA, AAAAレコードのFQDNと送信元メールサーバーのIPアドレスに紐づけられるPTRレコードの値が一致するかどうかで検証する。（ヘッダー、エンベロープも見てるのかはMTAによるのかも、情報不足）
送信側メールサーバーの逆引きレコード(PTRレコード)を設定すればOK。<br>
設定方法はサーバーをどこで契約しているかによる。<br>
GMO ConoHaをはじめとしたVPSなんかは管理画面から簡単に設定できるパターンが多いし、AWSも最近サポートへの起票無しでPTRレコードの設定をすることができるようになった。<br>
<a href=https://dev.classmethod.jp/articles/vpc-customers-customize-reverse-dns-elastic-ips-in-all-regions/>クラスメソッド: [UPDATE] 申請なしでElastic IPの逆引き設定ができるリージョンが増えました [ついに東京、大阪も!!]</a></p>
<p>サーバー側での設定がなく、設定するうえで失敗する理由がほとんどないため難易度をVery Easyとした。</p>
<h2 id=spfレコードの設定-難易度-easy>SPFレコードの設定 (難易度: Easy)</h2>
<p><a href=https://datatracker.ietf.org/doc/html/rfc7208>RFC7208</a>によって定義されている。策定は2014年4月。<br>
受信側メールサーバーがメール送信側のIPアドレスを確認し、メールを送信してきたFQDNに登録されているTXTレコード（SPF）に照らし合わせてチェックすることで、送信元のサーバーが妥当なものであるか検証する。<br>
一見すると上記のPTRレコード方式と似ているが、より設定に自由度が増えた認証の方式である。<br>
メールを送付するFQDNにDNS上のTXTレコードで設定を投入すればOK。<br>
設定の内容だが、メールサーバーのIPアドレスを指定するもの、MXレコードを読み込ませる設定にするもの、設定を外部から引っ張ってくるものなど柔軟な設定ができる。<br>
設定方法は様々なサイトに乗ってるため割愛。</p>
<h3 id=注意事項>[注意事項]</h3>
<p>SPFレコードを編集するときにやらかす例が大手でもちらほらある。<br>
<blockquote class=twitter-tweet><p lang=ja dir=ltr>をいをいドコモやっちまったな。<br>密林と同じ致命的ミスやってる。 <a href=https://t.co/UAHciwkcww>pic.twitter.com/UAHciwkcww</a></p>&mdash; Hi. NONOGAKI (@xplntr) <a href="https://twitter.com/xplntr/status/1438406689837891592?ref_src=twsrc%5Etfw">September 16, 2021</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<br>
なにをやらかしたか？というとSPFレコードは同じFQDN上で2個以上設定してはいけないところにある。<br>
上記のツイートのような設定をすると、SPF Permerrorとなり、SPFによるドメイン認証が無効となる。(つまり@docomo.ne.jp発のメールが送りにくくなる！）<br>
SPFの設定はFQDNにつきレコードの数は1つしか許されていないが、各設定項目の数は可変であるため、include: aspmx.pardot.comの設定を下の奴にねじ込んでおけば済んだはず。<br>
インフラエンジニアあるあるだけど、軽微な追加・変更作業が致命的な問題に繋がることも多いのでちゃんとレビューなどを徹底したほうがいい。<br>
個人的なファイトスタイルだが、やらかすと問題が大きくなりそうなドメインの場合、設定前に一時的にTTLを60~120秒にしておくと良いと思う。<br>
上記のドコモの場合、ツイートでも言及していたが、TTLキャッシュが最大86400秒(24時間)残るため、どこかのユーザーは最大1日メールが届かなくなる恐れがある。<br>
これをTTL120秒にしておけば120秒間隔で問題にカタがつけられるため、TTLのコントロール技術も学ぶといい。<br>
(ドコモのようなクラスになってくるとDNS問い合わせによるネットワーク/DNSサーバーへの負荷もすごそうだが…。)<br>
話がすごく脱線しているが、DNSもメールと密接に紐づいているため、DNSも勉強しような。</p>
<p>サーバー側の設定がなく、設定自体も簡単なため難易度をEasyとした。</p>
<h2 id=dkimレコードの設定-難易度-medium>DKIMレコードの設定 (難易度: Medium)</h2>
<p><a href=https://datatracker.ietf.org/doc/html/rfc6376/>RFC 6376</a>によって定義されている。策定は2011年9月。<br>
送信側メールサーバーはRSAで電子署名したメールのデータをメールヘッダーに付与し送付する。<br>
受信側メールサーバーは受信したメールにあるDKIMのデータが格納されているメールヘッダー（DKIM-Signature）を確認し、そこに記載されているセレクタ情報を確認した後、DNSに問い合わせを行い、公開鍵を取得する。<br>
取得した公開鍵と秘密鍵が一致するならば署名検証が行えるため、検証ができる。</p>
<p>何言ってるかよくわからんけど、メールの耐改ざん性を獲得したドメイン認証技術。<br>
DNSレコードの登録のみではなく、サーバー上でOpenDKIMや秘密鍵、セレクタの設定やMTAの設定を行う必要があり、少し難易度が上がる。<br>
とはいえ、強いエンジニアたちが皆構築ログをあげているため、構築で大きなつまづきをすることはないと思う。</p>
<p>サーバーの設定もあるが、情報は多く出回っているため難易度をMediumとした。</p>
<h2 id=dmarcレコードの設定-難易度-easy>DMARCレコードの設定 (難易度: Easy)</h2>
<p><a href=https://datatracker.ietf.org/doc/html/rfc7489/>RFC 7489</a>によって定義されている。策定は2015年3月。
DMARCは前述のドメイン認証とは少し異なり、それ自体ではドメイン認証の効力を持っているとは言い難い。<br>
DMARCの本質的な効力は"受信側サーバーがなりすましメールを受け取った"ときに効果を発揮する。<br>
DMARCはなりすましメールを受信したメールサーバーがその後の対応内容を決める為に利用されるものだからだ。
DMARCの設定では、DMARCの認証に失敗したメールを受信側でリジェクトしてもらうもの、迷惑メールに隔離してもらうもの、DMARCの認証に失敗したメールのレポート送付先を指定できるものがある。<br>
対応内容はメールで利用するドメインの頭に<code>_dmarc</code>を入れ、そのFQDNにTXTレコードを入れる形。<br>
私が普段設定するときは迷惑メールに隔離してもらったうえ、レポートの送付は特に利用しない設定にしている。<br>
私個人からすればDMARCは正直そこまで設定する必要のある設定とは思っていなかった。やりすぎではないかと思っていた。<br>
しかし、以下の記事ではPaypalではDMARC導入後では70%, MicrosoftのOutlookでは50%以上のなりすましメールを削減できたとある。<br>
<a href=https://dmarc.org/press/release-20140218/>https://dmarc.org/press/release-20140218/</a></p>
<p><strong>めっちゃ重要じゃん、DMARC&mldr;</strong></p>
<p>サーバー側の設定がなく、設定自体も簡単なため難易度をEasyとした。</p>
<h2 id=インフラエンジニアとしての個人のお気持ち>インフラエンジニアとしての個人のお気持ち</h2>
<p>最初にメールは枯れた技術、みたいなことを書いてしまったが、今もアップデートが続いている技術である。<br>
SPFの話を少し長めに書いたのも、その辺りに少し思うところがあるため。<br>
難易度が低い？設定が単純？それはそうだけど、設定変更時に一文字ミスったら認識されずTTLが切れるまで地獄を見ることになるかもしれない。そもそも重要な仕様を把握していなくてやらかすかもしれない。<br>
よくわかってないIT担当者がめちゃくちゃにいじって大爆死している例をみたことはある？その後の爆弾処理を押し付けられる係には？<br>
これを見てくれたみんなはミスをやらかして<strong>時すでに時間切れ</strong>かつ<strong>致命的な致命傷</strong>になる前に色々打てる手段はちゃんと打ってくれな！<br>
あとそろそろPPAPも廃止しようね。</p>
<ul>
<li>Q: なんで難易度がMediumまでしかないんですか？Hardはどこに行ったんです？</li>
<li>A: インフラの安定運用をするのがVery Hard、はっきりわかんだね。</li>
</ul>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Posts</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/index.xml>Rss</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#ドメイン認証とは>ドメイン認証とは</a></li>
<li><a href=#具体的なドメイン認証のやり方>具体的なドメイン認証のやり方</a></li>
<li><a href=#ptrレコードの設定-難易度-very-easy>PTRレコードの設定 (難易度: Very Easy)</a></li>
<li><a href=#spfレコードの設定-難易度-easy>SPFレコードの設定 (難易度: Easy)</a>
<ul>
<li><a href=#注意事項>[注意事項]</a></li>
</ul>
</li>
<li><a href=#dkimレコードの設定-難易度-medium>DKIMレコードの設定 (難易度: Medium)</a></li>
<li><a href=#dmarcレコードの設定-難易度-easy>DMARCレコードの設定 (難易度: Easy)</a></li>
<li><a href=#インフラエンジニアとしての個人のお気持ち>インフラエンジニアとしての個人のお気持ち</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&text=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&title=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81&body=Check out this article: https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&title=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&title=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fxrzhev.com%2fposts%2f2022-04-06%2f&t=%e3%83%a1%e3%83%bc%e3%83%ab%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e8%aa%8d%e8%a8%bc%e3%81%be%e3%81%a8%e3%82%81" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2023 xrzhev
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Posts</a></li>
<li><a href=/categories>Categories</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/index.xml>Rss</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
</html>